#!/bin/bash
#
# Run FieldWorks from development source tree
#
# Copyright (c) 2022 SIL International
# This software is licensed under the LGPL, version 2.1 or later
# (http://www.gnu.org/licenses/lgpl-2.1.html)

set -xueo pipefail

script_dir="$(readlink --canonicalize $(dirname "$0"))"
repo_root="$(readlink --canonicalize "${script_dir}/..")"
CONFIGURATION="${CONFIGURATION-Debug}"
output_configuration_dir="${repo_root}/Output/${CONFIGURATION}"
cd "${repo_root}/"

Build/set-registry

FLEXBRIDGE_CONFIGURATION="${FLEXBRIDGE_CONFIGURATION-Debug}"
export FLEXBRIDGEDIR="${FLEXBRIDGEDIR-${repo_root}/../flexbridge/output/${FLEXBRIDGE_CONFIGURATION}/net461}"
export FW_DEBUG=true
export FLEXBRIDGE_DEBUG=true
export SIL_REPORTING_LOGGING=foreground

source environ

FW_EXE="${output_configuration_dir}/FieldWorks.exe"
env | sort
exec ${FW_COMMAND_PREFIX-} ${FW_MONO_COMMAND:-mono} ${FW_MONO_OPTS-} \
  --debug "${FW_EXE}" "$@"
