<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <UseWindowsForms>true</UseWindowsForms>
    <RootNamespace>LanguageExplorer</RootNamespace>
    <Description>LanguageExplorer</Description>
    <NoWarn>168;169;219;414;649</NoWarn>
  </PropertyGroup>

  <ItemGroup>
    <PackageReference Include="Encoding-Converters-Core" Version="0.0.8" PrivateAssets="native" />
    <PackageReference Include="CsvHelper" Version="29.0.0" />
    <PackageReference Include="Geckofx60.64" Version="60.0.55" GeneratePathProperty="true" />
    <PackageReference Include="GitVersion.MsBuild" Version="5.10.3" PrivateAssets="All" />
    <PackageReference Include="Newtonsoft.Json" Version="13.0.2" />
    <PackageReference Include="SIL.Archiving" Version="11.0.0" />
    <PackageReference Include="SIL.Chorus.App" Version="5.1.0-beta0028" />
    <PackageReference Include="SIL.Core" Version="11.0.0" />
    <PackageReference Include="SIL.ExCSS" Version="2.0.2" />
    <PackageReference Include="SIL.LCModel" Version="10.2.0-beta0068" GeneratePathProperty="true" />
    <PackageReference Include="SIL.LCModel.FixData" Version="10.2.0-beta0068" />
    <PackageReference Include="SIL.LCModel.Core" Version="10.2.0-beta0068" GeneratePathProperty="true" />
    <PackageReference Include="SIL.Media" Version="11.0.0" />
    <PackageReference Include="SIL.Windows.Forms.GeckoBrowserAdapter" Version="11.0.0" />
    <PackageReference Include="TreeViewAdv" Version="1.7.0" />
    <PackageReference Include="WindowsShortcutFactory" Version="1.1.0" />
  </ItemGroup>

  <ItemGroup>
    <ProjectReference Include="..\..\Lib\src\FormLanguageSwitch\FormLanguageSwitch.csproj" />
    <ProjectReference Include="..\FwCoreDlgs\FwCoreDlgs.csproj" />
    <ProjectReference Include="..\FwResources\FwResources.csproj" />
    <ProjectReference Include="..\ParatextImport\ParatextImport.csproj" />
    <ProjectReference Include="..\ParserCore\ParserCore.csproj" />
    <ProjectReference Include="..\RootSite\RootSite.csproj" />
  </ItemGroup>

  <Target Name="GeneratePartsAndLayoutFiles" BeforeTargets="CoreCompile">
    <XslTransformation OutputPaths="../../DistFiles/Parts/GeneratedParts.xml" XmlInputPaths="@(SilLCModelFile)" XslInputPath="Controls/DetailControls/PartGenerator/PartGenerate.xslt" />
    <XslTransformation OutputPaths="../../DistFiles/Parts/Generated.fwlayout" XmlInputPaths="@(SilLCModelFile)" XslInputPath="Controls/DetailControls/PartGenerator/LayoutGenerate.xslt" />
    <Message Text="Updated GeneratedParts.xml and Generated.fwlayout (if needed)." />
  </Target>

  <ItemGroup>
    <PresentationXslFiles Include="../Transforms/Presentation/*.xsl" />
    <EmbeddedResource Include="Controls/MGA/CheckBox.bmp" />
    <EmbeddedResource Include="Controls/MGA/CheckedBox.bmp" />
    <EmbeddedResource Include="Controls/MGA/CLSDFOLD.BMP" />
    <EmbeddedResource Include="Controls/MGA/Complex.bmp" />
    <EmbeddedResource Include="Controls/MGA/FSType.bmp" />
    <EmbeddedResource Include="Controls/MGA/OPENFOLD.BMP" />
    <EmbeddedResource Include="Controls/MGA/Radio.bmp" />
    <EmbeddedResource Include="Controls/MGA/RadioSelected.bmp" />
    <EmbeddedResource Include="Controls/MGA/UserChoice.bmp" />
  </ItemGroup>

  <ItemGroup>
    <Reference Include="System.Design" />
  </ItemGroup>

  <ItemGroup>
    <Compile Update="Controls\MGA\MGAStrings.Designer.cs">
      <DesignTime>True</DesignTime>
      <AutoGen>True</AutoGen>
      <DependentUpon>MGAStrings.resx</DependentUpon>
    </Compile>
  </ItemGroup>

  <ItemGroup>
    <Compile Update="Controls\MGA\MGAStrings.Designer.cs">
      <DesignTime>True</DesignTime>
      <AutoGen>True</AutoGen>
      <DependentUpon>MGAStrings.resx</DependentUpon>
    </Compile>
  </ItemGroup>

  <!-- The GeckoFx60 package does not successfully copy these files even though it was intended to do so -->
  <Target Name="CopyGeckoSupportFiles" BeforeTargets="Build">
    <ItemGroup>
     <FirefoxFiles Include="$(PkgGeckoFx60_64)/content/Firefox/*.*" />
    </ItemGroup>
    <MakeDir Directories="$(OutputPath)/Firefox" />
    <Copy SourceFiles="@(FirefoxFiles)" DestinationFolder="$(OutputPath)/Firefox" SkipUnchangedFiles="true" />
  </Target>
  
  <Target Name="CopyLcmFiles" BeforeTargets="Build">
    <Copy SourceFiles="@(SilLCModelTemplates)" DestinationFolder="../../DistFiles/Templates" SkipUnchangedFiles="true" />
    <Copy SourceFiles="@(SilLCModelStylesDtd)" DestinationFolder="../../DistFiles" SkipUnchangedFiles="true" />
    <Error Text="There is a problem with the properties exported from the LCM package" Condition="!Exists($(SilLcModelCoreIcuDataFilesFolder))" />
    <ItemGroup>
       <IcuDataFiles Include="$(SilLcModelCoreIcuDataFilesFolder)/**/*.*" />
    </ItemGroup>
    <Copy SourceFiles="@(IcuDataFiles)" DestinationFolder="../../DistFiles/Icu54/%(RecursiveDir)" SkipUnchangedFiles="true" />
  </Target>
  
  <Target Name="CopyNHunspellFiles" BeforeTargets="GenerateBindingRedirects">
    <Copy SourceFiles="$(PkgNHunspell)/content/Hunspellx64.dll" DestinationFolder="$(OutputPath)" SkipUnchangedFiles="true" />
  </Target>

  <!-- This parallels the BuildXslAssemblies target for ApplicationTransforms in ParserCore -->
  <Target Name="BuildXslAssemblies" Inputs="@(PresentationXslFiles)" Outputs="$(OutputPath)/PresentationTransforms.dll" BeforeTargets="CoreCompile">
    <!-- Mono doesn't have an XSL compiler so we just put the XSLs in a resource assembly -->
    <Csc TargetType="library" OutputAssembly="$(OutputPath)/PresentationTransforms.dll" Optimize="true" Platform="AnyCPU" Resources="@(PresentationXslFiles)" Condition="'$(OS)'=='Unix'" />
    <!-- Only Windows has the xsltc tool for compiling XSLs -->
    <!-- The WindowsSDK_ExecutablePath_x64 does not contain the xsltc executable, but the x86 path contains one that can build a 64bit assembly -->
    <Exec Command="xsltc.exe /settings:document /platform:x64 /out:$(OutputPath)\PresentationTransforms.dll @(PresentationXslFiles, ' ')" Condition="'$(OS)'!='Unix'" EnvironmentVariables="PATH=$(WindowsSDK_ExecutablePath_x86.Replace(';','%3B'))" />
  </Target>
</Project>